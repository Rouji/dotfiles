#!/bin/bash
function close {
    killall jackd
    killall alsa_in
    killall alsa_out
}

trap close INT

jackd -dalsa -dhw:CARD=USB -r44100 -p64 -n2 &
sleep 1
while pidof jackd; do
    sleep 1
    if ! pidof alsa_in; then
        alsa_in -j alsa2jack -d cloop &
        sleep 1
        jack_connect alsa2jack:capture_1 system:playback_1
        jack_connect alsa2jack:capture_2 system:playback_2
    fi
    if ! pidof alsa_out; then
        alsa_out -j jack2alsa -d ploop &
        sleep 1
        jack_connect system:capture_1 jack2alsa:playback_1
        #jack_connect system:capture_2 jack2alsa:playback_2
    fi
done > /dev/null


